===== docker-compose.yml =====
services:db:build:context:.dockerfile:Dockerfile-postgresqlvolumes:-postgres_data:/var/lib/postgresql/dataports:-"5432:5432"environment:-POSTGRES_DB=db-POSTGRES_USER=fabriciopa-POSTGRES_PASSWORD=5472adminer:build:context:.dockerfile:Dockerfile-adminerports:-"8080:8080"depends_on:-dbweb:build:context:.dockerfile:Dockerfile-djangocommand:pythonmanage.pyrunserver0.0.0.0:8000volumes:-./ft_trans:/codeports:-"8000:8000"depends_on:-dbenvironment:-DATABASE_URL=postgres://fabriciopa:5472@db/dbvolumes:postgres_data:
===== init-database.sh =====
#!/bin/bashset-e#FonctionpourexécuterdescommandesSQLpsql_execute(){psql-vON_ERROR_STOP=1--username"$POSTGRES_USER"--dbname"$POSTGRES_DB"-c"$1"}#Vérifiersilabasededonnéesexistedéjàifpsql_execute"\l"|grep-q"$POSTGRES_DB";thenecho"Labasededonnées$POSTGRES_DBexistedéjà.Utilisationdelabaseexistante."elseecho"Labasededonnées$POSTGRES_DBn'existepas.Créationdelabasededonnées..."#Créerlabasededonnéespsql_execute"CREATEDATABASE$POSTGRES_DB;"#Seconnecteràlanouvellebasededonnéespsql_execute"\c$POSTGRES_DB"#ExécuterlescriptSQLpourcréerlestablespsql-vON_ERROR_STOP=1--username"$POSTGRES_USER"--dbname"$POSTGRES_DB"-f/docker-entrypoint-initdb.d/init-database.sqlecho"Basededonnées$POSTGRES_DBcrééeetinitialiséeavecsuccès."fi
===== init-database.sql =====
--InitialisationdelabasededonnéespourleprojetPong--SuppressiondestablesexistantessiellesexistentDROPTABLEIFEXISTSusersCASCADE;DROPTABLEIFEXISTSfriendsCASCADE;DROPTABLEIFEXISTSmatchesCASCADE;DROPTABLEIFEXISTStournamentsCASCADE;DROPTABLEIFEXISTStournament_participantsCASCADE;DROPTABLEIFEXISTSprivate_messagesCASCADE;DROPTABLEIFEXISTSuser_settingsCASCADE;--TabledesutilisateursCREATETABLEusers(idSERIALPRIMARYKEY,usernameVARCHAR(50)UNIQUENOTNULL,emailVARCHAR(100)UNIQUENOTNULL,password_hashVARCHAR(255)NOTNULL,display_nameVARCHAR(50)UNIQUENOTNULL,avatar_urlVARCHAR(255)DEFAULT'default_avatar.png',created_atTIMESTAMPWITHTIMEZONEDEFAULTCURRENT_TIMESTAMP,last_loginTIMESTAMPWITHTIMEZONE,is_onlineBOOLEANDEFAULTFALSE,winsINTEGERDEFAULT0,lossesINTEGERDEFAULT0);--Tabledesrelationsd'amitiéCREATETABLEfriends(idSERIALPRIMARYKEY,user_idINTEGERREFERENCESusers(id),friend_idINTEGERREFERENCESusers(id),statusVARCHAR(20)CHECK(statusIN('pending','accepted')),UNIQUE(user_id,friend_id));--TabledesmatchsCREATETABLEmatches(idSERIALPRIMARYKEY,tournament_idINTEGER,player1_idINTEGERREFERENCESusers(id),player2_idINTEGERREFERENCESusers(id),winner_idINTEGERREFERENCESusers(id),scoreVARCHAR(20),played_atTIMESTAMPWITHTIMEZONEDEFAULTCURRENT_TIMESTAMP);--TabledestournoisCREATETABLEtournaments(idSERIALPRIMARYKEY,nameVARCHAR(100)NOTNULL,start_dateTIMESTAMPWITHTIMEZONE,end_dateTIMESTAMPWITHTIMEZONE);--TabledesparticipantsauxtournoisCREATETABLEtournament_participants(idSERIALPRIMARYKEY,tournament_idINTEGERREFERENCEStournaments(id),user_idINTEGERREFERENCESusers(id),UNIQUE(tournament_id,user_id));--TabledesmessagesprivésCREATETABLEprivate_messages(idSERIALPRIMARYKEY,sender_idINTEGERREFERENCESusers(id),receiver_idINTEGERREFERENCESusers(id),messageTEXTNOTNULL,sent_atTIMESTAMPWITHTIMEZONEDEFAULTCURRENT_TIMESTAMP,is_readBOOLEANDEFAULTFALSE);--TabledesparamètresutilisateurCREATETABLEuser_settings(user_idINTEGERPRIMARYKEYREFERENCESusers(id),notification_preferencesJSONB,language_preferenceVARCHAR(10)DEFAULT'en',theme_preferenceVARCHAR(20)DEFAULT'light');--CréationdesindexpouraméliorerlesperformancesCREATEINDEXidx_friends_user_idONfriends(user_id);CREATEINDEXidx_friends_friend_idONfriends(friend_id);CREATEINDEXidx_matches_tournament_idONmatches(tournament_id);CREATEINDEXidx_matches_player1_idONmatches(player1_id);CREATEINDEXidx_matches_player2_idONmatches(player2_id);CREATEINDEXidx_private_messages_sender_idONprivate_messages(sender_id);CREATEINDEXidx_private_messages_receiver_idONprivate_messages(receiver_id);--InsertiondequelquesdonnéesdetestINSERTINTOusers(username,email,password_hash,display_name)VALUES('fab','fab@example.com','fab','fab'),('player2','player2@example.com','hashed_password','PlayerTwo');INSERTINTOfriends(user_id,friend_id,status)VALUES(1,2,'accepted');INSERTINTOtournaments(name,start_date,end_date)VALUES('FirstTournament',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP+INTERVAL'1day');INSERTINTOtournament_participants(tournament_id,user_id)VALUES(1,1),(1,2);INSERTINTOmatches(tournament_id,player1_id,player2_id,winner_id,score)VALUES(1,1,2,1,'3-2');INSERTINTOprivate_messages(sender_id,receiver_id,message)VALUES(1,2,'Goodgame!');INSERTINTOuser_settings(user_id,notification_preferences)VALUES(1,'{"email":true,"push":false}'),(2,'{"email":false,"push":true}');
===== Dockerfile-adminer =====
FROMadminer:latest#Setthedefaulttheme(optional)ENVADMINER_DESIGNdarcula#Youcanaddcustomizationshereifneeded#Forexample,toaddplugins:#ADDhttps://raw.githubusercontent.com/vrana/adminer/master/plugins/plugin.php/var/www/html/plugins/#ADDhttps://raw.githubusercontent.com/vrana/adminer/master/plugins/login-servers.php/var/www/html/plugins/EXPOSE8080
===== Dockerfile-django =====
#UseanofficialPythonruntimeasaparentimageFROMpython:3.10#SetenvironmentvariablesENVPYTHONDONTWRITEBYTECODE1ENVPYTHONUNBUFFERED1#SetworkdirectoryWORKDIR/code#InstalldependenciesCOPYrequirements.txt/code/RUNpipinstall--upgradepipRUNpipinstall-rrequirements.txt#CopyprojectCOPY./ft_trans/code/#ExposetheporttheapprunsonEXPOSE8000#RuntheapplicationCMD["python","manage.py","runserver","0.0.0.0:8000"]
===== Dockerfile-postgresql =====
FROMpostgres:16#Copiezlescriptd'initialisationCOPYinit-database.sh/docker-entrypoint-initdb.d/COPYinit-database.sql/docker-entrypoint-initdb.d/#Définissezlesvariablesd'environnementENVPOSTGRES_DB=dbENVPOSTGRES_USER=fabriciopaENVPOSTGRES_PASSWORD=5472#ExposezleportPostgreSQLEXPOSE5432
===== ./ft_trans/ft_trans/asgi.py =====
"""ASGIconfigforft_transproject.ItexposestheASGIcallableasamodule-levelvariablenamed``application``.Formoreinformationonthisfile,seehttps://docs.djangoproject.com/en/5.0/howto/deployment/asgi/"""importosfromdjango.core.asgiimportget_asgi_applicationos.environ.setdefault('DJANGO_SETTINGS_MODULE','ft_trans.settings')application=get_asgi_application()
===== ./ft_trans/ft_trans/urls.py =====
"""URLconfigurationforft_transproject.The`urlpatterns`listroutesURLstoviews.Formoreinformationpleasesee:https://docs.djangoproject.com/en/5.0/topics/http/urls/Examples:Functionviews1.Addanimport:frommy_appimportviews2.AddaURLtourlpatterns:path('',views.home,name='home')Class-basedviews1.Addanimport:fromother_app.viewsimportHome2.AddaURLtourlpatterns:path('',Home.as_view(),name='home')IncludinganotherURLconf1.Importtheinclude()function:fromdjango.urlsimportinclude,path2.AddaURLtourlpatterns:path('blog/',include('blog.urls'))"""fromdjango.contribimportadminfromdjango.urlsimportpath,includeurlpatterns=[path('admin/',admin.site.urls),path('',include('pong.urls')),]
===== ./ft_trans/ft_trans/wsgi.py =====
"""WSGIconfigforft_transproject.ItexposestheWSGIcallableasamodule-levelvariablenamed``application``.Formoreinformationonthisfile,seehttps://docs.djangoproject.com/en/5.0/howto/deployment/wsgi/"""importosfromdjango.core.wsgiimportget_wsgi_applicationos.environ.setdefault('DJANGO_SETTINGS_MODULE','ft_trans.settings')application=get_wsgi_application()
===== ./ft_trans/ft_trans/settings.py =====
"""Djangosettingsforft_transproject.Generatedby'django-adminstartproject'usingDjango5.0.7.Formoreinformationonthisfile,seehttps://docs.djangoproject.com/en/5.0/topics/settings/Forthefulllistofsettingsandtheirvalues,seehttps://docs.djangoproject.com/en/5.0/ref/settings/"""frompathlibimportPathfromdatetimeimporttimedelta#Buildpathsinsidetheprojectlikethis:BASE_DIR/'subdir'.BASE_DIR=Path(__file__).resolve().parent.parent#Quick-startdevelopmentsettings-unsuitableforproduction#Seehttps://docs.djangoproject.com/en/5.0/howto/deployment/checklist/#SECURITYWARNING:keepthesecretkeyusedinproductionsecret!SECRET_KEY='django-insecure-69i@hqe0&ym6z6o7nho0vxoqwn24bg4a4f&_6fxqdkh9s5!ym5'#SECURITYWARNING:don'trunwithdebugturnedoninproduction!DEBUG=TrueALLOWED_HOSTS=[]APPEND_SLASH=FalseALLOWED_HOSTS=['localhost','127.0.0.1']#ApplicationdefinitionINSTALLED_APPS=['pong.apps.PongConfig','django.contrib.admin','django.contrib.auth','django.contrib.contenttypes','django.contrib.sessions','django.contrib.messages','django.contrib.staticfiles','rest_framework','rest_framework.authtoken','corsheaders','rest_framework_simplejwt']MIDDLEWARE=['django.middleware.security.SecurityMiddleware','django.contrib.sessions.middleware.SessionMiddleware','django.middleware.common.CommonMiddleware','django.middleware.csrf.CsrfViewMiddleware','django.contrib.auth.middleware.AuthenticationMiddleware','django.contrib.messages.middleware.MessageMiddleware','django.middleware.clickjacking.XFrameOptionsMiddleware','corsheaders.middleware.CorsMiddleware','django.middleware.common.CommonMiddleware','django.middleware.csrf.CsrfViewMiddleware',#forsession'django.contrib.sessions.middleware.SessionMiddleware',#forsession'django.contrib.auth.middleware.AuthenticationMiddleware',#forsession]CORS_ALLOWED_ORIGINS=["http://localhost:8000",]CORS_ALLOW_CREDENTIALS=TrueLOGGING={'version':1,'disable_existing_loggers':False,'handlers':{'console':{'class':'logging.StreamHandler',},},'root':{'handlers':['console'],'level':'INFO',},}ROOT_URLCONF='ft_trans.urls'TEMPLATES=[{'BACKEND':'django.template.backends.django.DjangoTemplates','DIRS':[],'APP_DIRS':True,'OPTIONS':{'context_processors':['django.template.context_processors.debug','django.template.context_processors.request','django.contrib.auth.context_processors.auth','django.contrib.messages.context_processors.messages',],},},]WSGI_APPLICATION='ft_trans.wsgi.application'#Database#https://docs.djangoproject.com/en/5.0/ref/settings/#databasesDATABASES={'default':{'ENGINE':'django.db.backends.postgresql_psycopg2','NAME':'db','USER':'fabriciopa','PASSWORD':'5472','HOST':'db','PORT':'5432',}}#Passwordvalidation#https://docs.djangoproject.com/en/5.0/ref/settings/#auth-password-validatorsAUTH_PASSWORD_VALIDATORS=[{'NAME':'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',},{'NAME':'django.contrib.auth.password_validation.MinimumLengthValidator',},{'NAME':'django.contrib.auth.password_validation.CommonPasswordValidator',},{'NAME':'django.contrib.auth.password_validation.NumericPasswordValidator',},]#Internationalization#https://docs.djangoproject.com/en/5.0/topics/i18n/LANGUAGE_CODE='en-us'TIME_ZONE='UTC'USE_I18N=TrueUSE_TZ=True#Staticfiles(CSS,JavaScript,Images)#https://docs.djangoproject.com/en/5.0/howto/static-files/STATIC_URL='static/'STATICFILES_DIRS=[BASE_DIR/'pong/templates/',]#Defaultprimarykeyfieldtype#https://docs.djangoproject.com/en/5.0/ref/settings/#default-auto-fieldDEFAULT_AUTO_FIELD='django.db.models.BigAutoField'REST_FRAMEWORK={'DEFAULT_AUTHENTICATION_CLASSES':['rest_framework_simplejwt.authentication.JWTAuthentication',],}SIMPLE_JWT={#forjwt'ACCESS_TOKEN_LIFETIME':timedelta(minutes=60),'REFRESH_TOKEN_LIFETIME':timedelta(days=1),}
===== ./ft_trans/pong/admin.py =====
fromdjango.contribimportadminfrom.modelsimportQuestionadmin.site.register(Question)
===== ./ft_trans/pong/apps.py =====
fromdjango.appsimportAppConfigclassPongConfig(AppConfig):default_auto_field='django.db.models.BigAutoField'name='pong'
===== ./ft_trans/pong/models.py =====
importdatetimefromdjango.dbimportmodelsfromdjango.utilsimporttimezoneclassQuestion(models.Model):question_text=models.CharField(max_length=200)pub_date=models.DateTimeField("datepublished")def__str__(self):returnself.question_textclassChoice(models.Model):question=models.ForeignKey(Question,on_delete=models.CASCADE)choice_text=models.CharField(max_length=200)votes=models.IntegerField(default=0)def__str__(self):returnself.choice_text
===== ./ft_trans/pong/templates/index.html =====
{%loadstatic%}<!DOCTYPEhtml><htmllang="en"><head><linkrel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"><linkrel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css"><style>@importurl('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');</style><metacharset="UTF-8"><metaname="viewport"content="width=device-width,initial-scale=1.0"><title>ft_transcendence</title><linkhref="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"rel="stylesheet"integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"crossorigin="anonymous"><linkrel="stylesheet"href="{%static'css/styles.css'%}"><linkrel="stylesheet"href="{%static'css/avatar.css'%}"><linkrel="stylesheet"href="{%static'css/caroussel.css'%}"></head><body><divid="ft_transcendence"></div><script>varstaticUrl="{%static''%}";</script><scripttype="module"src="{%static'js/app.js'%}"></script><scriptsrc="https://cdn.jsdelivr.net/npm/chart.js"></script><scriptsrc="{%static'js/utils/unmask.js'%}"></script><scripttype="module"src="{%static'js/views/login.js'%}"></script><scripttype="module"src="{%static'js/views/register.js'%}"></script><scripttype="module"src="{%static'js/views/dashboard.js'%}"></script><scripttype="module"src="{%static'js/app.js'%}"></script><scripttype="module"src="{%static'js/views/gameplay.js'%}"></script><scripttype="module"src="{%static'js/views/profile.js'%}"></script><scriptsrc="{%static'js/views/gameplay_friends.js'%}"></script><scriptsrc="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script><scriptsrc="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script><scriptsrc="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script><scriptsrc="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script></body></html>
===== ./ft_trans/pong/templates/js/app.js =====
import{login}from'./views/login.js';import{register}from'./views/register.js';import{dashboard}from'./views/dashboard.js';import{gameplay}from'./views/gameplay.js';import{profile}from'./views/profile.js';import{settings}from'./views/settings.js';//Déclarationderoutercommeunevariableglobaleaumoduleletrouter;functioninitRouter(){router=function(){constpath=window.location.pathname;if(path.startsWith('/profile/')){constfriendName=decodeURIComponent(path.split('/').pop());profile(friendName);}else{switch(path){case'/':login();break;case'/dashboard':dashboard();break;case'/login':login();break;case'/register':register();break;case'/gameplay':gameplay();break;case'/gameplay_friends':gameplay_friends();break;case'/settings':settings();break;default:console.log('404:Pagenotfound');}}};window.addEventListener('popstate',router);//Gestionnairepourlesclicssurlesliensdocument.body.addEventListener('click',e=>{if(e.target.matches('[data-link]')){e.preventDefault();navigateTo(e.target.getAttribute('href'));}});//Initialroutecallrouter();}exportfunctionnavigateTo(pathname){constfullPath=window.location.origin+pathname;window.history.pushState({},pathname,fullPath);router();}document.addEventListener('DOMContentLoaded',initRouter);//ExportezégalementinitRoutersivousenavezbesoinailleursexport{initRouter};
===== ./ft_trans/pong/templates/js/utils/server.js =====
//node_server/server.jsconstexpress=require('express');consthttp=require('http');constsocketIo=require('socket.io');constcors=require('cors');constapp=express();constserver=http.createServer(app);constio=socketIo(server,{cors:{origin:"*",//Permettouteslesorigines,àajusterselonvosbesoinsmethods:["GET","POST"]}});//UtiliserlemiddlewareCORSapp.use(cors());app.get('/',(req,res)=>{res.send('Socket.ioserverisrunning');});io.on('connection',(socket)=>{console.log('auserconnected');socket.on('disconnect',()=>{console.log('userdisconnected');});socket.on('chat_message',(msg)=>{io.emit('chat_message',msg);});});server.listen(3000,()=>{console.log('listeningon*:3000');});
===== ./ft_trans/pong/templates/js/utils/token.js =====
exportfunctioncallAPI(url,method='GET',body=null){constheaders={'Content-Type':'application/json','Authorization':`Bearer${localStorage.getItem('accessToken')}`};constoptions={method:method,headers:headers,};if(body){options.body=JSON.stringify(body);}returnfetch(url,options).then(response=>{if(response.status===401){//Tokenexpiré,essayezdelerafraîchirreturnrefreshToken().then(success=>{if(success){//Tokenrafraîchi,réessayezl'appeloriginalheaders.Authorization=`Bearer${localStorage.getItem('accessToken')}`;returnfetch(url,options);}else{//Échecdurafraîchissement,redirigezverslapagedeconnexionnavigateTo('/login');thrownewError('Sessionexpirée');}});}returnresponse;}).then(response=>response.json());}functionrefreshToken(){returnfetch('http://localhost:8000/api/token/refresh/',{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify({refresh:localStorage.getItem('refreshToken')}),}).then(response=>response.json()).then(data=>{if(data.access){localStorage.setItem('accessToken',data.access);returntrue;}else{returnfalse;}}).catch(()=>false);}exportasyncfunctiongetCsrfToken(){constresponse=awaitfetch('/api/set-csrf-token/',{method:'GET',credentials:'include',});if(response.ok){constdata=awaitresponse.json();returndata.csrfToken;}thrownewError('FailedtogetCSRFtoken');}
===== ./ft_trans/pong/templates/js/utils/unmask.js =====
exportfunctionchangeType(x,type){if(x.type===type){returnx;}try{return(x.type=type);//Attemptdirecttypechange}catch(e){varhtml=$("<div>").append(x.clone()).html();varregex=/type=(\")?([^\"\s]+)(\")?/;vartmp=$(html.match(regex)==null?html.replace(">",'type="'+type+'">')://Replaceentiretagifnotypeattributehtml.replace(regex,'type="'+type+'"'));//Replaceexistingtypeattributetmp.data('type',x.data('type'));varevents=x.data('events');varcb=function(events){returnfunction(){for(variinevents){vary=events[i];for(varjiny){tmp.bind(i,y[j].handler);}}};}(events);x.replaceWith(tmp);setTimeout(cb,10);returntmp;}}changeType.ready(function(){$('.unmask').on('click',function(){if($(this).prev('input').attr('type')==='password'){changeType($(this).prev('input'),'text');}else{changeType($(this).prev('input'),'password');}returnfalse;});});
===== ./ft_trans/pong/templates/js/views/gameplay_friends.js =====
exportfunctiongameplay_friends(navigateTo,$player_name){document.getElementById('ft_transcendence').innerHTML=`<ulclass="navnavbar-expand-lgjustify-content-center"><aclass="nav-linkdisabled">pongonline</a><aclass="nav-linkdisabled">${$player_name}</a><aclass="nav-link"href=""id="logoutLink">Logout</a></ul><divclass="containergame-container"><divclass="game-area"><!--Yourgamelogichere(canvas,etc.)--></div></div><footerclass="py-3my-4"><pclass="text-centertext-body-secondary">©202442Company,Inc</p></footer>`;attachEventHandlers11(navigateTo,$player_name);}functionattachEventHandlers11(navigateTo,$player_name){//Navigatetodashboardisexitisclickeddocument.querySelector('.btn-danger').addEventListener('click',function(event){event.preventDefault();console.log('Exitbuttonclicked');navigateTo('dashboard',$player_name);});}
===== ./ft_trans/pong/templates/js/views/profile.js =====
import{navigateTo}from'../app.js';exportfunctionprofile(friendName){//Simulonsdesdonnées(àremplacerpardesdonnéesréellesdelabasededonnées)conststats={wins:120,losses:80,totalGames:200,winRatio:(120/200*100).toFixed(2),avgScore:7.5,totalPlayTime:'50h30m',highestAILevel:8,recentMatches:[{opponent:'Alice',result:'Win',date:'2024-03-15'},{opponent:'Bob',result:'Loss',date:'2024-03-14'},{opponent:'AILevel7',result:'Win',date:'2024-03-13'},{opponent:'Charlie',result:'Win',date:'2024-03-12'},{opponent:'AILevel6',result:'Win',date:'2024-03-11'},]};constplayer_name=localStorage.getItem('player_name');document.getElementById('ft_transcendence').innerHTML=`<divclass="dashboard-container"><ulclass="navjustify-content-betweenalign-items-center"><aclass="navbar-brand"href="#"><imgsrc="${staticUrl}content/logo2.png"id="pongonlineLink"alt="Logo"width="30"height="30"></a><liclass="nav-item"><aclass="nav-linkdisabled">${player_name}</a></li><liclass="nav-item"><aclass="nav-link"href="#"id="logoutLink">Logout</a></li></ul><h3id="header-dashboard"class="text-center">${friendName}'sProfile</h3><divclass="text-center"id="profile-picture"><imgsrc="https://i.ibb.co/DVfTxB2/avatar5.png"class="img-thumbnailrounded-circled-flexjustify-content-center"alt="ProfilePicture"></div><buttontype="button"id="friendButton"class="btn-dark">AddFriend</button><divclass="rowmt-4"><divclass="col-md-6"><divclass="card"><divclass="card-body"><h5class="card-title">PlayerStatistics</h5><pclass="card-text">Wins:${stats.wins}<br>Losses:${stats.losses}<br>WinRatio:${stats.winRatio}%<br>TotalGames:${stats.totalGames}<br>AverageScore:${stats.avgScore}<br>TotalPlayTime:${stats.totalPlayTime}<br>HighestAILevelBeaten:${stats.highestAILevel}</p></div></div></div><divclass="col-md-6"><divclass="card"><divclass="card-body"><h5class="card-title">Win/LossRatio</h5><divid="chartContainer"style="height:200px;width:100%;"><canvasid="winLossChart"></canvas></div></div></div></div></div><divclass="cardmt-4"style="margin-bottom:3%;"><divclass="card-body"><h5class="card-title">RecentMatches</h5><ulclass="list-group">${stats.recentMatches.map(match=>`<liclass="list-group-item">${match.date}:${match.result}vs${match.opponent}</li>`).join('')}</ul></div></div><footerclass="py-3my-4"><pclass="text-centertext-body-secondary">©202442Company,Inc</p></footer></div>`;attachEventHandlers2(navigateTo,friendName);createWinLossChart(stats.wins,stats.losses);}functionattachEventHandlers2(navigateTo,friendName){document.getElementById('pongonlineLink').addEventListener('click',function(event){event.preventDefault();navigateTo('/dashboard');});//Friendbuttonlogic(asbefore)letisFriend=false;letrequestSent=false;constfriendButton=document.getElementById('friendButton');functionupdateFriendButton(){if(isFriend){friendButton.innerText='AlreadyFriends';friendButton.classList.add('btn-dark','disabled');}elseif(requestSent){friendButton.innerText='RequestSent';friendButton.classList.add('btn-dark','disabled');}else{friendButton.innerText='AddFriend';friendButton.classList.remove('disabled');}}friendButton.addEventListener('click',()=>{if(isFriend){isFriend=false;}elseif(requestSent){requestSent=false;}else{requestSent=true;}updateFriendButton();});updateFriendButton();}functioncreateWinLossChart(wins,losses){constctx=document.getElementById('winLossChart').getContext('2d');newChart(ctx,{type:'pie',data:{labels:['Wins','Losses'],datasets:[{data:[wins,losses],backgroundColor:['#4CAF50','#F44336']}]},options:{responsive:true,maintainAspectRatio:false}});}
===== ./ft_trans/pong/templates/js/views/register.js =====
import{navigateTo}from'../app.js';import{getCsrfToken}from'../utils/token.js';exportfunctionregister(){document.getElementById('ft_transcendence').innerHTML=`<ulclass="navnavbar-expand-lgjustify-content-center"></ul><h1>Register</h1><liclass="breadcrumb-itemactive"id="arrowbackregister">Back</li><divclass="containerlogin-container"><formid="registerForm"><p><labelfor="username"style="margin-top:3%;">username</label><inputtype="text"value=""placeholder="EnterUsername"id="username"required></p><p><labelfor="email">Email</label><inputtype="email"value=""placeholder="EnterEmail"id="email"required></p><p><labelfor="password">password</label><divclass="password-wrapper"><inputtype="password"value=""placeholder="EnterPassword"id="password"class="password"required><buttonclass="unmask"type="button"title="Mask/Unmaskpasswordtocheckcontent"><iclass="fasfa-lock"></i></button></div></p><p><p><labelfor="confirmPassword">confirmpassword</label><divclass="password-wrapper"><inputtype="password"value=""placeholder="ConfirmPassword"id="confirmPassword"class="password"><buttonclass="unmask"type="button"title="Mask/Unmaskpasswordtocheckcontent"><iclass="fasfa-lock"></i></button></div></p><labelfor="email">chooseavatar</label><divclass="choose-avatar-container"><aclass="carousel-control-prev"role="button"data-slide="prev"><spanclass="carousel-control-prev-icon"id="carousel-control-prev-icon"aria-hidden="true"></span><spanclass="sr-only">Previous</span></a><divclass="choose-avatar"><divid="carouselExampleControls"class="carouselslide"data-ride="carousel"data-interval="false"><divclass="carousel-inner"><divclass="carousel-itemactive"><imgclass="d-blockavatar-image"src="https://i.ibb.co/C2WLdyY/avatar1.png"alt="Firstslide"></div><divclass="carousel-item"><imgclass="d-blockavatar-image"src="https://i.ibb.co/0t3JTMz/avatar2.png"alt="Secondslide"></div><divclass="carousel-item"><imgclass="d-blockavatar-image"src="https://i.ibb.co/K08BjJx/avatar3.png"alt="Thirdslide"></div><divclass="carousel-item"><imgclass="d-blockavatar-image"src="https://i.ibb.co/6XW1X2L/avatar4.png"alt="Fourthslide"></div><divclass="carousel-item"><imgclass="d-blockavatar-image"src="https://i.ibb.co/DVfTxB2/avatar5.png"alt="Fithslide"></div><divclass="carousel-item"><imgclass="d-blockavatar-image"src="https://i.ibb.co/Bzvqgg3/avatar6.png"alt="Sixthslide"></div><divclass="carousel-item"><imgclass="d-blockavatar-image"src="https://i.ibb.co/FDg3t8m/avatar7.png"alt="Seventhslide"></div></div></div></div><aclass="carousel-control-next"role="button"data-slide="next"><spanclass="carousel-control-next-icon"id="carousel-control-next-icon"aria-hidden="true"></span><spanclass="sr-only">Next</span></a></div></p><buttonid="registerbutton"type="submit"class="btnbtn-primarybtn-block">Register</button><buttonid="registerbutton42"type="button"class="btnbtn-primarybtn-block">Registerwith42</button></form></div><footerclass="py-3my-4"><pclass="text-centertext-body-secondary">©202442Company,Inc</p></footer>`;setupRegisterEvents(navigateTo);}functionsetupRegisterEvents(navigateTo){document.addEventListener('click',function(event){if(event.target.classList.contains('unmask')||event.target.closest('.unmask')){constbutton=event.target.closest('.unmask');//Targettheentirebuttonconstinput=button.previousElementSibling;if(input.type==='password'){input.type='text';button.querySelector('i').classList.remove('fa-lock');button.querySelector('i').classList.add('fa-lock-open');}else{input.type='password';button.querySelector('i').classList.remove('fa-lock-open');button.querySelector('i').classList.add('fa-lock');}}});document.getElementById('registerForm').addEventListener('submit',asyncfunction(event){event.preventDefault();constusername=document.getElementById('username').value;constemail=document.getElementById('email').value;constpassword=document.getElementById('password').value;constconfirmPassword=document.getElementById('confirmPassword').value;if(password!==confirmPassword){alert('Passwordsdonotmatch.Pleasetryagain.');return;}constselectedAvatar=document.querySelector('.carousel-item.activeimg').src;try{constcsrfToken=awaitgetCsrfToken();constresponse=awaitfetch('/api/register/',{method:'POST',headers:{'Content-Type':'application/json','X-CSRFToken':csrfToken,},body:JSON.stringify({username:username,email:email,password:password,avatar_url:selectedAvatar}),credentials:'include',});constcontentType=response.headers.get("content-type");if(contentType&&contentType.indexOf("application/json")!==-1){constdata=awaitresponse.json();if(data.success){alert(data.message);navigateTo('/login');}else{alert('Errorduringregistration:'+data.error);}}else{console.error("Receivednon-JSONresponse:",awaitresponse.text());alert('Receivedanunexpectedresponsefromtheserver.Pleasetryagain.');}}catch(error){console.error('Error:',error);alert('Anerroroccurredduringregistration:'+error.message);}});document.getElementById('arrowbackregister').addEventListener('click',function(event){event.preventDefault();navigateTo('/login');});//carrouseldocument.getElementById('carousel-control-next-icon').addEventListener('click',function(event){event.preventDefault();$('#carouselExampleControls').carousel('next');});document.getElementById('carousel-control-prev-icon').addEventListener('click',function(event){event.preventDefault();$('#carouselExampleControls').carousel('prev');});}functiongetCookie(name){letcookieValue=null;if(document.cookie&&document.cookie!==''){constcookies=document.cookie.split(';');for(leti=0;i<cookies.length;i++){constcookie=cookies[i].trim();if(cookie.substring(0,name.length+1)===(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}returncookieValue;}
===== ./ft_trans/pong/templates/js/views/settings.js =====
exportfunctionsettings(){constplayer_name=localStorage.getItem('player_name')||'Player';console.log('settingsview');document.getElementById('ft_transcendence').innerHTML=`<divclass="dashboard-container"><ulclass="navjustify-content-betweenalign-items-center"><aclass="navbar-brand"href="#"><imgsrc="${staticUrl}content/logo2.png"id="pongonlineLink"alt="Logo"width="30"height="30"></a><liclass="nav-item"><aclass="nav-linkdisabled">${player_name}</a></li><liclass="nav-item"><aclass="nav-link"href="#"id="logoutLink">Logout</a></li></ul><h3id="header-dashboard"class="text-center">UserSettings</h3><divclass="containermt-4"><formid="settingsForm"><divclass="mb-3"><labelfor="displayName"class="form-label">DisplayName</label><inputtype="text"class="form-control"id="displayName"name="displayName"></div><divclass="mb-3"><labelfor="email"class="form-label">Email</label><inputtype="email"class="form-control"id="email"name="email"></div><divclass="mb-3"><labelfor="avatar"class="form-label">Avatar</label><divclass="d-flexalign-items-center"><imgid="currentAvatar"src="https://i.ibb.co/FDg3t8m/avatar7.png"alt="CurrentAvatar"class="img-thumbnailrounded-circleme-3"style="width:100px;height:100px;"><inputtype="file"class="form-control"id="avatar"name="avatar"accept="image/*"></div></div><divclass="mb-3"><labelclass="form-label">Notifications</label><divclass="form-check"><inputclass="form-check-input"type="checkbox"id="emailNotifications"name="emailNotifications"><labelclass="form-check-label"for="emailNotifications">EmailNotifications</label></div></div><buttontype="submit"class="btnbtn-primary">SaveSettings</button></form><h4class="mt-5">ChangePassword</h4><formid="changePasswordForm"><divclass="mb-3"><labelfor="newPassword"class="form-label">NewPassword</label><inputtype="password"class="form-control"id="newPassword"name="newPassword"></div><divclass="mb-3"><labelfor="confirmPassword"class="form-label">ConfirmNewPassword</label><inputtype="password"class="form-control"id="confirmPassword"name="confirmPassword"></div><buttontype="submit"class="btnbtn-success">ChangePassword</button></form><buttonid="backToDashboard"class="btnbtn-secondarymt-4">BacktoDashboard</button></div></div><footerclass="py-3my-4"><pclass="text-centertext-body-secondary">©202442Company,Inc</p></footer>`;attachEventSettingsPage(navigateTo,player_name);}functionattachEventSettingsPage(navigateTo,player_name){constpongonlineLink=document.getElementById('pongonlineLink');constlogoutLink=document.getElementById('logoutLink');constbackToDashboard=document.getElementById('backToDashboard');constsettingsForm=document.getElementById('settingsForm');constchangePasswordForm=document.getElementById('changePasswordForm');constavatarInput=document.getElementById('avatar');pongonlineLink.addEventListener('click',(event)=>{event.preventDefault();navigateTo('/dashboard');});logoutLink.addEventListener('click',(event)=>{event.preventDefault();console.log('Logoutsuccessful');navigateTo('/login');});backToDashboard.addEventListener('click',()=>navigateTo('/dashboard'));settingsForm.addEventListener('submit',(event)=>{event.preventDefault();constformData=newFormData(settingsForm);//Hereyouwouldtypicallysendtheformdatatoyourbackendconsole.log('Settingssaved',Object.fromEntries(formData));alert('Settingssavedsuccessfully!');});changePasswordForm.addEventListener('submit',(event)=>{event.preventDefault();constnewPassword=document.getElementById('newPassword').value;constconfirmPassword=document.getElementById('confirmPassword').value;if(newPassword!==confirmPassword){alert('Passwordsdonotmatch');return;}//Hereyouwouldtypicallysendthenewpasswordtoyourbackendconsole.log('Passwordchanged');alert('Passwordchangedsuccessfully!');});avatarInput.addEventListener('change',(event)=>{constfile=event.target.files[0];if(file){constreader=newFileReader();reader.onload=(e)=>{document.getElementById('currentAvatar').src=e.target.result;};reader.readAsDataURL(file);}});//Pre-fillformfieldsdocument.getElementById('displayName').value=player_name;document.getElementById('email').value='user@example.com';document.getElementById('emailNotifications').checked=true;}
===== ./ft_trans/pong/templates/js/views/gameplay.js =====
exportfunctiongameplay(){$player_name=localStorage.getItem('player_name');if($player_name==null){$player_name='Player';}console.log('gameplayview');document.getElementById('ft_transcendence').innerHTML=`<ulclass="navnavbar-expand-lgjustify-content-center"><aclass="nav-linkdisabled">pongonline</a><aclass="nav-linkdisabled">${$player_name}</a><aclass="nav-link"href=""id="logoutLink">Logout</a></ul><divclass="containergame-container"><divclass="game-area"><!--Yourgamelogichere(canvas,etc.)--></div></div><footerclass="py-3my-4"><pclass="text-centertext-body-secondary">©202442Company,Inc</p></footer>`;attachEventHandlers2(navigateTo,$player_name);}functionattachEventHandlers2(navigateTo,$player_name){//Navigatetodashboardisexitisclickeddocument.querySelector('.btn-danger').addEventListener('click',function(event){event.preventDefault();console.log('Exitbuttonclicked');navigateTo('dashboard',$player_name);});}
===== ./ft_trans/pong/templates/js/views/dashboard.js =====
import{navigateTo}from'../app.js';let$player_name;exportfunctiondashboard(player_name){$player_name=player_name;$player_name='Player';document.getElementById('ft_transcendence').innerHTML=`<divclass="dashboard-container"><ulclass="navjustify-content-betweenalign-items-center"><aclass="navbar-brand"href="#"><imgsrc="${staticUrl}content/logo2.png"id="pongonlineLink"alt="Logo"width="30"height="30"></a><liclass="nav-item"><aclass="nav-linkdisabled">${player_name}</a></li><liclass="nav-item"><aclass="nav-link"href="#"id="logoutLink">Logout</a></li></ul><h3id="header-dashboard"class="text-center">${$player_name}'sDashboard</h3><divclass="text-center"id=profile-picture><imgsrc="https://i.ibb.co/FDg3t8m/avatar7.png"class="img-thumbnailrounded-circled-flexjustify-content-center"alt="ProfilePicture"id=img_profile_pic></div><divid="profileDropdown"class="dropdown-menu"style="display:none;"><aclass="dropdown-item"href="#"id="settings">Settings</a><aclass="dropdown-item"href="#"id="logoutLink">Logout</a></div><divclass="container-fluid"><divclass="row"><divclass="col-md-3sidebar"style="margin-left:inherit;"><ulid="friends"class="list-group"><liclass="list-group-item"data-friend="Friend1">Friend1</li><liclass="list-group-item"data-friend="Friend2">Friend2</li><liclass="list-group-item"data-friend="Friend3">Friend3</li></ul><divid="friendDropdown"class="dropdown-menu"style="display:none;"><aclass="dropdown-item"href="#"id="sendMessage">SendPrivateMessage</a><aclass="dropdown-item"href="#"id="startGame">StartaGame</a><aclass="dropdown-item"href="#"id="viewProfile">ViewProfile</a></div><divid="friendDropdown_chat"class="dropdown-menu_chat"style="display:none;"><aclass="dropdown-item"href="#"id="sendMessage">SendPrivateMessage</a><aclass="dropdown-item"href="#"id="addToFriend">AddToFriend</a><aclass="dropdown-item"href="#"id="blockUser">BlockUser</a><aclass="dropdown-item"href="#"id="viewProfile">ViewProfile</a></div><divclass="offcanvasoffcanvas-end"data-bs-scroll="true"tabindex="-1"id="chatbox"aria-labelledby="chatboxLabel"><divclass="offcanvas-header"><buttontype="button"class="btn-close"data-bs-dismiss="offcanvas"aria-label="Close"></button></div><divclass="offcanvas-body"><divid="private-chats-container"></div><divclass="input-container2"><textareaid="message-input2"placeholder="Typeyourmessage..."rows="1"></textarea><buttonid="send-button2">Send</button></div></div></div></div><divclass="col-md-9main-content"><divclass="card"><divclass="card-body"><divclass="btn-group"id="play_button""role="group"aria-label="Basicexample"><buttontype="button"id="game_alone"class="btnbtn-primary">Play</button><buttontype="button"id="game_friend"class="btnbtn-primary">Playwithfriend</button><buttontype="button"id="game_tournament"class="btnbtn-primary">Playtournament</button></div></div></div><divclass="card"><divclass="chat-container"><divclass="chat-log"id="chat-log"></div><divclass="input-container"><textareaid="message-input"placeholder="Typeyourmessage..."rows="1"></textarea><buttonid="send-button">Send</button></div></div></div></div></div></div><divclass="toast-containerposition-fixedbottom-0end-0p-3"><divid="addFriendToast"class="toast"role="alert"aria-live="assertive"aria-atomic="true"><divclass="toast-header"><strongclass="me-auto">FriendRequest</strong><buttontype="button"class="btn-close"data-bs-dismiss="toast"aria-label="Close"></button></div><divclass="toast-body">Friendrequestsentsuccessfully!</div></div></div><divclass="toast-containerposition-fixedbottom-0end-0p-3"><divid="blockUserToast"class="toast"role="alert"aria-live="assertive"aria-atomic="true"><divclass="toast-header"><strongclass="me-auto">BlockUser</strong><buttontype="button"class="btn-close"data-bs-dismiss="toast"aria-label="Close"></button></div><divclass="toast-body">Userblockedsuccessfully!</div></div></div><footerclass="py-3my-4"><pclass="text-centertext-body-secondary">©202442Company,Inc</p></footer></div>`;setupDashboardEvents(navigateTo,$player_name);fetchAndDisplayFriends();}constsocket=io('http://localhost:3000');functionsetupDashboardEvents(navigateTo,player_name){//Logoutdocument.getElementById('logoutLink').addEventListener('click',function(event){event.preventDefault();console.log('Logoutsuccessful');navigateTo('/login');});//Gamesolodocument.getElementById('game_alone').addEventListener('click',function(event){event.preventDefault();console.log('Playgame_alonebuttonclicked');navigateTo('/gameplay');});//Gamewithfrienddocument.getElementById('game_friend').addEventListener('click',function(event){event.preventDefault();console.log('Playgame_friendbuttonclicked');navigateTo('/gameplay_friends');});//Friendmenudocument.querySelectorAll('#friends.list-group-item').forEach(item=>{item.addEventListener('click',handleFriendClick);});//Profilepicturedropdowndocument.getElementById('img_profile_pic').addEventListener('click',handleProfilePictureClick);//Hidethedropdownmenuwhenclickingoutsideofitdocument.addEventListener('click',hideDropdowns);//Preventthedropdownmenufromclosingwhenclickinginsideitdocument.getElementById('friendDropdown').addEventListener('click',(event)=>event.stopPropagation());document.getElementById('friendDropdown_chat').addEventListener('click',(event)=>event.stopPropagation());document.getElementById('profileDropdown').addEventListener('click',(event)=>event.stopPropagation());//Dropdownactionsdocument.getElementById('sendMessage').addEventListener('click',showChatbox);document.getElementById('friendDropdown_chat').querySelector('#sendMessage').addEventListener('click',showChatbox);document.getElementById('startGame').addEventListener('click',startGame);document.getElementById('settings').addEventListener('click',goTosettings);//Chatfunctionnalitisdocument.getElementById('send-button').addEventListener('click',sendMessage);socket.on('chat_message',receiveMessage);//Privatemessagewithfrienddocument.getElementById('send-button2').addEventListener('click',sendPrivateMessage);//SendmessagewhenpressingEnterkeydocument.addEventListener("keydown",handleEnterKey);//Viewprofiledocument.getElementById('friendDropdown').querySelector('#viewProfile').addEventListener('click',viewProfile);document.getElementById('friendDropdown_chat').querySelector('#viewProfile').addEventListener('click',viewProfile);//Friendactionsdocument.getElementById('friendDropdown_chat').querySelector('#addToFriend').addEventListener('click',addFriend);document.getElementById('friendDropdown_chat').querySelector('#blockUser').addEventListener('click',blockUser);//Profilepicture/////////////////////////////////////////////////////////////////////////////////////////////////////////////////toastwhenaddfrienddocument.getElementById('friendDropdown_chat').querySelector('#addToFriend').addEventListener('click',function(event){event.preventDefault();vartoast=newbootstrap.Toast(document.getElementById('addFriendToast'));toast.show();});//toastwhenblockuserdocument.getElementById('friendDropdown_chat').querySelector('#blockUser').addEventListener('click',function(event){event.preventDefault();vartoast=newbootstrap.Toast(document.getElementById('blockUserToast'));toast.show();});setInterval(fetchAndDisplayFriends,60000);}functionscrollToBottom2(friendName){constchatLog2=document.getElementById(`chat-log-${friendName}`);chatLog2.scrollTop=chatLog2.scrollHeight;}functionformatMessage(message){/*fornohtmlinjection*/if(message.startsWith("```")){return`<pre>${message}</pre>`;}/*syntax:[player_name]:message*/message=message.replace(/</g,"&lt;").replace(/>/g,"&gt;");message=message.replace(/(```[\s\S]*?```)/g,'<pre>$1</pre>');return`${message}`;}functionhandleProfilePictureClick(){event.stopPropagation();constdropdown=document.getElementById('profileDropdown');constvisibleDropdowns=document.querySelectorAll('.dropdown-menu,.dropdown-menu_chat');visibleDropdowns.forEach(dropdown=>{dropdown.style.display='none';});dropdown.style.top=`${event.clientY}px`;dropdown.style.left=`${event.clientX}px`;dropdown.style.display='block';}functionhandleFriendClick(){event.stopPropagation();constdropdown=document.getElementById('friendDropdown');constfriendName=this.getAttribute('data-friend');//HideallvisibledropdownsconstvisibleDropdowns=document.querySelectorAll('.dropdown-menu,.dropdown-menu_chat');visibleDropdowns.forEach(dropdown=>{dropdown.style.display='none';});//Positionthedropdownneartheclickedfrienditemdropdown.style.top=`${event.clientY}px`;dropdown.style.left=`${event.clientX}px`;dropdown.style.display='block';//Storetheclickedfriend'snamedropdown.setAttribute('data-friend',friendName);}functionhideDropdowns(){constdropdown=document.getElementById('friendDropdown');if(dropdown){dropdown.style.display='none';}constdropdown2=document.getElementById('friendDropdown_chat');if(dropdown2){dropdown2.style.display='none';}constdropdown3=document.getElementById('profileDropdown');if(dropdown3){dropdown3.style.display='none';}}functionshowChatbox(event){event.preventDefault();constfriendName=event.target.closest('.dropdown-menu').getAttribute('data-friend');varchatbox=newbootstrap.Offcanvas(document.getElementById('chatbox'));chatbox.show();setupPrivateChat(friendName);document.getElementById('chat-log2').innerHTML='';}functionsetupPrivateChat(friendName){constprivateChatContainer=document.getElementById('private-chats-container');privateChatContainer.innerHTML=`<h5class="offcanvas-title"id="chatboxLabel">PrivateMessage:${friendName}</h5><divclass="chat-container2"><divclass="chat-log2"id="chat-log-${friendName}"></div></div>`;loadMessages(friendName);//Updatesendbuttonclickeventdocument.getElementById('send-button2').onclick=()=>sendPrivateMessage(friendName);}functionstartGame(event){event.preventDefault();constfriendName=document.getElementById('friendDropdown').getAttribute('data-friend');console.log(`Startagamewith${friendName}`);navigateTo('/gameplay');}functiongoTosettings(event){event.preventDefault();console.log('Gotosettings');navigateTo('/settings');}functionsendMessage(event){event.preventDefault();constmessageInput=document.getElementById('message-input');if(messageInput.value.trim()!==''){constmessage=formatMessage(messageInput.value);socket.emit('chat_message',{name:$player_name,message:message});}messageInput.value='';}functionreceiveMessage(msg){constchatLog=document.getElementById('chat-log');constmessageElement=document.createElement('div');//Créerl'élémentusernameetdéfinirsesattributsconstusernameElement=document.createElement('span');//Changéde'a'à'span'usernameElement.classList.add('username-link');usernameElement.dataset.friend=msg.name;usernameElement.innerText=`[${msg.name}]`;//Activerlemenudéroulantlorsquelenomd'utilisateurestcliquéusernameElement.addEventListener('click',function(event){event.preventDefault();//Ajoutépourempêcherlecomportementpardéfautevent.stopPropagation();constdropdown=document.getElementById('friendDropdown_chat');constfriendName=this.dataset.friend;//UtilisezdatasetaulieudegetAttributeusernameElement.classList.add('username-link','bold-username');//MasquertouslesmenusdéroulantsvisiblesconstvisibleDropdowns=document.querySelectorAll('.dropdown-menu,.dropdown-menu_chat');visibleDropdowns.forEach(dropdown=>{dropdown.style.display='none';});//Positionnerlemenudéroulantprèsdel'élémentamicliquédropdown.style.top=`${event.clientY}px`;dropdown.style.left=`${event.clientX}px`;dropdown.style.display='block';//Stockerlenomdel'amicliquédropdown.dataset.friend=friendName;//UtilisezdatasetaulieudesetAttribute});//Créerl'élémentmessageetdéfinirsontexteconstmessageTextElement=document.createElement('span');messageTextElement.innerText=`:${msg.message}`;//Ajouterlesélémentsusernameetmessageàl'élémentmessagemessageElement.appendChild(usernameElement);messageElement.appendChild(messageTextElement);chatLog.appendChild(messageElement);//Fairedéfilerjusqu'enbasduchatlogchatLog.scrollTop=chatLog.scrollHeight;}functionsendPrivateMessage(friendName){constmessageInput=document.getElementById('message-input2');constmessage=messageInput.value.trim();if(message!==''){constchatLog=document.getElementById(`chat-log-${friendName}`);constmessageElement=document.createElement('div');messageElement.innerHTML=`<spanclass="username-linkbold-username">[Player]:</span>${message}`;chatLog.appendChild(messageElement);saveMessage(friendName,message);messageInput.value='';chatLog.scrollTop=chatLog.scrollHeight;}}functionhandleEnterKey(event){if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendMessage(event);}}functionaddFriend(event){event.preventDefault();constfriendName=document.getElementById('friendDropdown').getAttribute('data-friend');console.log(`Add${friendName}tofriends`);}functionblockUser(event){event.preventDefault();constfriendName=document.getElementById('friendDropdown').getAttribute('data-friend');console.log(`Block${friendName}`);}functionviewProfile(event){event.preventDefault();constfriendName=document.getElementById('friendDropdown').getAttribute('data-friend');console.log(`Viewprofileof${friendName}`);navigateTo(`/profile/${friendName}`);}socket.on('connect_error',(error)=>{console.error('Connectionerror:',error);//Gérezl'erreurdemanièreappropriée});functionfetchAndDisplayFriends(){callAPI('http://localhost:8000/api/friends/').then(data=>{constfriendsList=document.getElementById('friends');friendsList.innerHTML='';data.forEach(friend=>{constli=document.createElement('li');li.className='list-group-item';li.setAttribute('data-friend',friend.username);li.textContent=friend.username;li.addEventListener('click',handleFriendClick);friendsList.appendChild(li);});}).catch(error=>{console.error('Erreurlorsdelarécupérationdesamis:',error);});}functionsaveMessage(friendName,message){letmessages=JSON.parse(localStorage.getItem(`chat_${friendName}`))||[];messages.push({sender:'Player',message:message});localStorage.setItem(`chat_${friendName}`,JSON.stringify(messages));}functionloadMessages(friendName){constchatLog=document.getElementById(`chat-log-${friendName}`);constmessages=JSON.parse(localStorage.getItem(`chat_${friendName}`))||[];chatLog.innerHTML='';//Effacerlesmessagesprécédentsmessages.forEach(msg=>{constmessageElement=document.createElement('div');messageElement.innerHTML=`<spanclass="username-linkbold-username">[${msg.sender}]:</span>${msg.message}`;chatLog.appendChild(messageElement);});chatLog.scrollTop=chatLog.scrollHeight;}
===== ./ft_trans/pong/templates/js/views/login.js =====
import{navigateTo}from'../app.js';import{getCsrfToken}from'../utils/token.js';exportfunctionlogin(){console.log('loginview');document.getElementById('ft_transcendence').innerHTML=`<imgsrc="${staticUrl}content/logo_400_400.png"id="logo_pong_login"alt="Logo"width="250"height="250"style="margin-bot:10%;"><divclass="containerlogin-container"><formid="loginForm"><p><labelfor="username"style="margin-top:3%;">username</label><inputtype="text"class="value=""placeholder="EnterUsername"id="username"></p><p><labelfor="password">password</label><divclass="password-wrapper"><inputtype="password"value=""placeholder="EnterPassword"id="password"class="password"><buttonclass="unmask"type="button"title="Mask/Unmaskpasswordtocheckcontent"><iclass="fasfa-lock"></i></button></div></p><buttontype="submit"class="btnbtn-primary">Login</button><divclass="text-center"><buttontype="button"id="create_account"class="btnbtn-outline-light">Createaccount</button></div></form></div><divclass="position-fixedtop-0start-50translate-middle-xp-3"style="z-index:11"><divid="loginToast"class="toast"role="alert"aria-live="assertive"aria-atomic="true"><divclass="toast-headerbg-dangertext-white"><strongclass="me-auto">LoginError</strong><buttontype="button"class="btn-close"data-bs-dismiss="toast"aria-label="Close"></button></div><divclass="toast-body">Invalidusernameorpassword</div></div></div></div></div><footerclass="py-3my-4"><pclass="text-centertext-body-secondary">©202442Company,Inc</p></footer>`;attachEventLoginPage(navigateTo);}functionattachEventLoginPage(navigateTo){/*navigatetodashboardpagewhenloginissuccessful*/document.getElementById('loginForm').addEventListener('submit',handleLogin);document.getElementById('create_account').addEventListener('click',function(event){event.preventDefault();navigateTo('/register');});/*navigatetocreateaccountpagewhencreateaccountisclicked*/constcreateButton=document.getElementById('create_account');if(createButton){createButton.addEventListener('click',function(event){event.preventDefault();console.log('clicktocreateaccountbutton');navigateTo('/register');});}/*lockbutton*/document.addEventListener('click',function(event){if(event.target.classList.contains('unmask')||event.target.closest('.unmask')){constbutton=event.target.closest('.unmask');//Targettheentirebuttonconstinput=button.previousElementSibling;if(input.type==='password'){input.type='text';button.querySelector('i').classList.remove('fa-lock');button.querySelector('i').classList.add('fa-lock-open');}else{input.type='password';button.querySelector('i').classList.remove('fa-lock-open');button.querySelector('i').classList.add('fa-lock');}}});document.addEventListener("keydown",function(event){//ifenterkeyispressetandloginformiscompletethensubmittheformif(event.key==="Enter"){document.getElementById('loginForm').dispatchEvent(newEvent('submit'));}});}asyncfunctionhandleLogin(event){event.preventDefault();constusername=document.getElementById('username').value;constpassword=document.getElementById('password').value;try{constcsrfToken=awaitgetCsrfToken();console.log("CSRFtokenobtained:",csrfToken);constresponse=awaitfetch('/api/login/',{method:'POST',headers:{'Content-Type':'application/json','X-CSRFToken':csrfToken,},body:JSON.stringify({username,password}),credentials:'include',});console.log("Loginrequestsent");//LogtherawresponsefordebuggingconstresponseText=awaitresponse.text();console.log("Rawresponse:",responseText);//TrytoparsetheresponseasJSONletdata;try{data=JSON.parse(responseText);}catch(error){console.error("ErrorparsingJSON:",error);thrownewError("ServerresponsewasnotvalidJSON");}if(data.success){//LoginsuccessfullocalStorage.setItem('accessToken',data.access);localStorage.setItem('refreshToken',data.refresh);localStorage.setItem('username',data.username);console.log('Loginsuccessful');navigateTo('/dashboard');}else{//LoginfailedshowLoginToast();}}catch(error){console.error('Error:',error);showLoginToast();}}functionshowLoginToast(){consttoastEl=document.getElementById('loginToast');consttoast=newbootstrap.Toast(toastEl);toast.show();}
===== ./ft_trans/pong/urls.py =====
fromdjango.urlsimportpathfrom.importviewsfromrest_framework_simplejwt.viewsimportTokenObtainPairView,TokenRefreshViewurlpatterns=[path('api/content/',views.content,name='content'),path('api/create_user/',views.create_user,name='create_user'),path('api/login/',views.login_view,name='login'),path('',views.index,name='index'),path('<path:path>',views.index,name='catch_all'),path('api/register/',views.register_view,name='register'),path('api/token/',TokenObtainPairView.as_view(),name='token_obtain_pair'),path('api/token/refresh/',TokenRefreshView.as_view(),name='token_refresh'),path('api/set-csrf-token/',views.set_csrf_token,name='set_csrf_token'),]
===== ./ft_trans/pong/views.py =====
fromdjango.httpimportJsonResponsefromdjango.contrib.auth.modelsimportUserfromdjango.contrib.authimportauthenticate,loginfromdjango.views.decorators.csrfimportcsrf_exemptfromdjango.views.decorators.csrfimportensure_csrf_cookiefromdjango.shortcutsimportrenderfromdjango.middleware.csrfimportget_tokenfromrest_framework_simplejwt.tokensimportRefreshTokenfromdjango.dbimportIntegrityErrorimportjson@csrf_exemptdefcreate_user(request):ifrequest.method=='POST':data=json.loads(request.body)user=User.create_user(data['username'],data=data['password'])returnJsonResponse({'message':'usercreatedwithid'+str(user.id)},status=201)else:returnJsonResponse({'error':'invalidrequest'},status=400)defindex(request,path=''):returnrender(request,'index.html')@ensure_csrf_cookiedeflogin_view(request):print('login_viewurl')ifrequest.method=='POST':data=json.loads(request.body)username=data.get('username')password=data.get('password')user=authenticate(request,username=username,password=password)ifuserisnotNone:#Loginsuccessfulrefresh=RefreshToken.for_user(user)returnJsonResponse({'success':True,'username':user.username,'access':str(refresh.access_token),'refresh':str(refresh),})else:#LoginfailedreturnJsonResponse({'success':False},status=401)returnJsonResponse({'error':'Invalidrequestmethod.'},status=400)defcontent(request):returnJsonResponse({'message':'contentpage'},status=200)@ensure_csrf_cookiedefregister_view(request):ifrequest.method=='POST':try:data=json.loads(request.body)username=data.get('username')email=data.get('email')password=data.get('password')avatar_url=data.get('avatar_url')ifUser.objects.filter(username=username).exists():returnJsonResponse({'success':False,'error':'Thisusernameisalreadytaken.'})ifUser.objects.filter(email=email).exists():returnJsonResponse({'success':False,'error':'Thisemailisalreadyinuse.'})user=User.objects.create_user(username=username,email=email,password=password)#Sivousavezunmodèledeprofilséparé,vouspouvezl'utiliserici#user.profile.avatar_url=avatar_url#user.profile.save()returnJsonResponse({'success':True,'message':'Accountcreatedsuccessfully.'})exceptIntegrityErrorase:returnJsonResponse({'success':False,'error':'Databaseintegrityerror.Pleasetryagain.'})exceptjson.JSONDecodeError:returnJsonResponse({'success':False,'error':'InvalidJSONdata.'})exceptExceptionase:returnJsonResponse({'success':False,'error':f'Anerroroccurred:{str(e)}'})returnJsonResponse({'success':False,'error':'Invalidrequestmethod.'})@ensure_csrf_cookiedefset_csrf_token(request):returnJsonResponse({'csrfToken':get_token(request)})
